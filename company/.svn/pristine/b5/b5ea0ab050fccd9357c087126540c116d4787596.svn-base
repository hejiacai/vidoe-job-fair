<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="Keywords" content="" />
<meta name="Description" content="" />
<title>汇博网_招聘中心_我的用户</title>
<!–[if lt IE9]>
<script src="{/version file='html5.js'/}"></script>
<![endif]–>
<link rel="stylesheet" type="text/css" href="{/version file='base.css'/}" />
<link rel="stylesheet" type="text/css" href="{/version file='comback.css'/}" />
<link rel="stylesheet" type="text/css" href="{/version file='icons.css'/}" />
<link rel="stylesheet" type="text/css" href="{/version file='account.css'/}" />
<link rel="stylesheet" type="text/css" href="{/version file='v2-widge.css'/}" />
	<script type="text/javascript" language="javascript" src="{/version file='jquery-1.8.3.js'/}"></script>
<script type="text/javascript" src="{/version file='version.js'/}"></script>
<script type="text/javascript">
window.CONFIG = {
	HOST: '{/$siteurl.style/}',
	COMBOPATH: '/js/v2/'
}
</script>
<script type="text/javascript" src="{/version file='hbjs.js,jquery.min.js,util.js,class.js,shape.js,event.js,aspect.js,attribute.js,cookie.js'/}"></script>
<script type="text/javascript" src="{/version file='global.js'/}"></script>
<style type="text/css">
.part{border:1px solid #dadada; border-radius:5px;padding:15px;margin:0 0 20px;zoom:1;}
.part dl{overflow:hidden;}
.part dl dt{float:left;display:inline;width:175px; text-align:center;}
.part dl dd{float:left;display:inline;width:745px;margin:5px 0 0;}
.part dl dt .ico{height:80px;width:100px;margin:0 auto;background:url({/$siteurl.style/}/img/c/c.gif) no-repeat;}
.part dl dt p{height:22px;line-height:22px;margin:5px 0 0;font-size:16px;}
.part dl dd p{line-height:30px;}
.part dl dd p a.btn3{margin:0 10px 0 0;}

.part1 dl dt .ico{background-position:0 0;}
.part2 dl dt .ico{background-position:-100px 0;}
.part3 dl dt .ico{background-position:-200px 0;}
.part4 dl dt .ico{background-position:-300px 0;}

.part1 p a.lnk{margin:0 10px; }

.part2 p.tit{height:45px;}
.part2 p.tit i.hbFntWes{float:left;display:inline;margin:0 5px 0 0;font-size:45px;}
.part2 p.tit span{float:left;font-size:12px;margin:8px 0 0 0;}
.part2 p.tit span em{font-weight:bold;font-size:16px;line-height:28px;margin:0 0 0 5px;}
.part2 p span.line{color:#cecece;margin:0 10px;}
.part2 p a.lnk{margin:0 10px;}
.part2 div.tip{line-height:30px;}
.part2 div.tip span.lst{float:left;display:inline;padding:0 10px 0 0;border-right:1px solid #ccc;margin-right:10px;height:24px;line-height:24px;}
.part2 div.tip span.last{border:0;}
.part2 div.tip .tipLay{top:-36px;left:-196px;}
.part2 div.tip .tipLayTxt{width:350px;font-size:12px;background:#fffce3;border:1px solid #fad5a8;}
.part2 div.tip .tipLay .tipArr{background:url({/$siteurl.style/}/img/common/contrl.gif) no-repeat -8px 0;width:8px;height:5px;top:auto;bottom:-4px;left:115px; z-index:4}

.part3 p.tit{font-weight:bold;}
.part3 p b{float:left;display:inline;height:30px;line-height:30px;font-weight:normal;}
.part3 p .bar{margin:7px 0 0;display:inline-block;}
.part3 p a{margin:0 10px 0;}

.part4 p.tit{height:45px;}
.part4 p.tit i.hbFntWes{float:left;display:inline;margin:0 5px 0 0;font-size:45px;}
.part4 p.tit span{float:left;display:inline;font-weight:bold;font-size:16px;line-height:28px;margin:8px 0 0 0;}
.part4 p.tit span em{}
.part4 dl dd.part4AttIng{margin:40px 0 0;}
.part4 dl dd.part4AttS{margin:33px 0 0;}
.part4 dl dd.part4AttS span a.btn3{margin:0 0 0 10px;font-weight:normal;}
.part4 dl dd.part4AttErr{margin:17px 0 0;}
.part4 dl dd.part4AttErr a.btn3{margin:0 0 0 10px;font-weight:normal;}
.part4 dl dd.part4AttNo{margin:17px 0 0;}
.part4 dl dd.part4AttNo a.btn3{margin:0 0 0 10px;font-weight:normal;}

.part2 p.notmember {margin-top: 20px;}

.firmMemberPge a{ float:left; display:block;width:160px; height:40px; line-height:40px; color:#fff; font-size:16px; background:#21a3df url({/$siteurl.style/}/img/c/new_index/firmicon16.png) 34px center no-repeat; border-radius:4px; text-indent:4.1em;#text-indent:4.8em;}
.firmMemberPge img{ float:left; display:block; margin:7px 20px 0 0;}
.firmMemberPge a:hover{ background:#107cae url({/$siteurl.style/}/img/c/new_index/firmicon16.png) 34px center no-repeat;}

.playm{display: inline-block;width:72px;height: 30px;background: url({/$siteurl.style/}/img/c/icon.jpg) no-repeat;text-indent: -999px;overflow: hidden;vertical-align: middle;margin-left: 15px}
</style>
</head>
<body id="body">
{/include file="new_header.html" par="企业管理" cur="账号管理"/}
<div class="content" id="content">
  <div class="account-content">
  	<div class="title">用户信息</div>
    <form id="account-form" class="account-form">
        <input type="hidden" name="account_id" value="{/$account_id/}" />
  		<div class="formMod">
            <div class="l">用户名</div>
            <div class="r">
                {/if $is_self/}
                <span class="mt5">{/$user_id/}</span>
                <input name="user_id" type="hidden" id="user_id" class="text" value="{/$user_id/}" />
                {/else if $operate_is_main/}
                    <span class="formText">
                        <input name="user_id" type="text" class="text" value="{/$user_id/}" placeholder="账号名" />
                    </span>
                    <span class="tipPos">
                        <span class="tipLay" data-for="user_id"></span>
                    </span>
                {//if/}
            </div>
            <div class="clear"></div>
        </div>
        {/if $is_self/}
        <div class="formMod">
            <div class="l">密码</div>
            <div class="r">
                <span class="mt5">**********<a id="upload-pwd" href="javascript:" class="upload-pwd">修改密码</a></span>
            </div>
            <div class="clear"></div>
        </div>
        {//if/}
  		<div class="formMod">
            <div class="l">姓名</div>
            <div class="r">
                <span class="formText">
                    <input name="user_name" type="text" class="text" value="{/$user_name/}">
                </span>
                <span class="tipPos">
                    <span class="tipLay" data-for="user_name"></span>
                </span>
            </div>
            <div class="clear"></div>
        </div>
        <div class="formMod">
            <div class="l">职位/身份</div>
            <div class="r">
                <span class="formText">
                    <input name="station" type="text" class="text" value="{/$station/}">
                </span>
                <span class="tipPos">
                    <span class="tipLay" data-for="station"></span>
                </span>
            </div>
            <div class="clear"></div>
            <p style="color:#666;font-size:12px;margin-top:5px;margin-left: 217px">例如：技术部经理/策划部主管/人事总监/销售经理</p>
        </div>
        {/if !$is_self/}
        <div class="formMod">
            <div class="l">密码</div>
            <div class="r">
                <span class="formText">
                    <input name="password" type="password" class="text">
                </span>
            </div>
            <div class="clear"></div>
        </div>
        {//if/}
        <div class="formMod">
            <div class="l">手机号</div>
            <div class="r">
                <span class="formText">
                    <input name="phone" type="text" class="text" value="{/$mobile_phone/}">
                </span>
                <span class="tipPos">
                    <span class="tipLay" data-for="phone"></span>
                </span>
            </div>
            <div class="clear"></div>
        </div>
        <div class="formMod">
            <div class="l">办公电话</div>
            <div class="r">
                <span class="formText">
                    <input name="zone_infor" type="text" class="text" placeholder="区号" style="width:50px" value="{/$zone_info/}">
                </span>
                <span class="formText" style="margin-left:5px">
                    <input name="phone_infor" type="text" class="text" placeholder="电话号码" value="{/$phone_info/}" style="width:73px">
                </span>
                <span class="formText" style="margin-left:5px">
                    <input name="ext_infor" type="text" class="text" placeholder="分机号" style="width:50px" value="{/$ext_info/}">
                </span>
                <span class="tipPos">
                    <span class="tipLay" data-for="tel"></span>
                </span>
            </div>
            <div class="clear"></div>
        </div>
        {/if $bind_weixin/}
        <div class="formMod">
            <div class="l">微信绑定</div>
            <div class="r">
                <span class="formText" style="padding-top: 3px; color:#339933">
                    已绑定
                </span>
                <span class="formText" style="margin-left:55px">
                    <a href="javascript:;" id="unbindWeixin" data-value="{/$open_id/}" style="border:1px solid #2b6fad; border-radius: 3px; display: inline-block; padding: 3px 10px; margin-left: 46px;">解除绑定</a>
                </span>
            </div>
            <div class="clear"></div>
        </div>
        {//if/}
        <div class="formMod">
            <div class="l">头像</div>
            <div class="r">
                <input type="hidden" name='head_photo' value="{/$head_photo/}" />
                <dl class="clearfix head-img" {/if !$has_head_photo/}style="display:none;"{//if/}>
                    <dt><img class="head_photo" src="{/if $head_photo/}{/$siteurl.style/}{//if/}{/$head_photo/}" /></dt>
                	<dd><a id="delAvaterBtn" href="javascript:">删除头像</a><!--<a id="editAvaterBtn" href="javascript:">编辑头像</a>--></dd>
                </dl>
                <dl class="head-upload-img" {/if $has_head_photo/}style="display:none;"{//if/}>
                	<dt><label id="fileBtn" style="width:92px;height:30px;background:url('{/$siteurl.style/}/img/account/upload-btn.jpg') no-repeat" for="imageFile"></label></dt>
                	<dd>支持图片格式：jpg jpeg png<br />图片大小不超过 1 M</dd>
                </dl>
            </div>
            <div class="clear"></div>
        </div>
        <div class="formBtn"><a id="submitBtn" class="btnsF16 btn1" href="javascript:void(0);">保存</a></div>
  	</form>
  </div>
</div>
{/include file="./footer.html"/}
<section class="floatRT"><a href="//www.huibo.com/about/message" target="_blank" class="serviceLink">我有问题要反馈</a><b></b></section>
<!--<script language="javascript" type="text/javascript" src="//int.dpool.sina.com.cn/iplookup/iplookup.php?format=js&ip={/$ip/}"></script>
-->
<script type="text/javascript">

hbjs.use('@validator, @fileUploader, @confirmBox, @hbCommon, @jobDialog', function(m){
	var validator = m['widge.validator.form'];
	var fileUploader = m['widge.fileUploader'];
	var ConfirmBox = m['widge.overlay.confirmBox'];
	var Dialog = m['widge.overlay.hbDialog'];
	var $ = m['product.hbCommon'].extend(m['cqjob.jobDialog']);
	$('input[type=text],input[type=password]').placeHolder();

	var avaterFile = new fileUploader({
		uploadURL: "{/get_url rule='/account/saveAcccountImages/'/}?account_id={/$account_id/}",
		imageURL: null,
		max: 1,
		fileExt: '.jpg,.png',
		param: 'url'
	});

//    var avaterFile1 = new fileUploader({
//        trigger:$('#editAvaterBtn'),
//		uploadURL: "{/get_url rule='/account/saveAcccountImages/'/}?account_id={/$account_id/}",
//		imageURL: null,  
//		max: 1,
//		fileExt: '.jpg,.png',
//		param: 'url'
//	});

	var loadingDialog,
		pWidth = 70,
		fontWidth = 18;

	avaterFile.on('startUpload', function(e){
		//上传开始
        var can_mod = $(this).attr('can_mod');
        if(can_mod == 0) return;console.log(can_mod);return;
		var msg = '正在上传中qq..';
		loadingDialog = ConfirmBox.timeBomb(msg, {
			name: 'normal',
			width: pWidth + msg.length * fontWidth,
			timeout: 0,
			hasMask: true
		});
	});
	avaterFile.on('progressError', function(e){
        var json = e.data;
		loadingDialog && loadingDialog.hide();
		$.anchorMsg(json.errorMsg);
        return;
	});
	avaterFile.on('progresed', function(e){
        var json = e.data;
        var path = json.url;
        var name = json.name;
        $('.head_photo').attr('src', path);
        $("input[name=head_photo]").val(name);
        $('.head-img').show();
        $('.head-upload-img').hide();
		loadingDialog && loadingDialog.hide();
	});

    /*avaterFile1.on('startUpload', function(e){
		//上传开始
		var msg = '正在上传中..';
		loadingDialog = ConfirmBox.timeBomb(msg, {
			name: 'normal',
			width: pWidth + msg.length * fontWidth,
			timeout: 0,
			hasMask: true
		});
	});
	avaterFile1.on('progressError', function(e){
        var json = e.data;
		loadingDialog && loadingDialog.hide();
		$.anchorMsg(json.errorMsg);
        return;
	});
	avaterFile1.on('progresed', function(e){
        var json = e.data;
        var path = json.url;
        var name = json.name;
        $('.head_photo').attr('src', path);
        $("input[name=head_photo]").val(name);
        $('.head-img').show();
        $('.head-upload-img').hide();
		loadingDialog && loadingDialog.hide();
	});*/


	$('#delAvaterBtn').on('click', function(){
		var imgname = $("input[name=head_photo]").val();
        var account_id = "{/$account_id/}";
        $.ajax({
            url:"{/get_url rule='/account/delAcccountImage/'/}",
            type:"post",
            dataType: "json",
            data: {imgname:imgname,account_id:account_id},
            success:function(json){
                if(json!=null&&json!=undefined&&json!=''){
                    if(json.status){
                        $("input[name=head_photo]").val("");
                        $('.head_photo').attr('src', '');
                        $('.head-img').hide();
                        $('.head-upload-img').show();
                        $.anchorMsg("删除成功");
                        return;
                    }
                }
                $.anchorMsg("删除头像失败，请稍后再试");
            }
        });
	});

	var modPwdHTML = [
		'<form id="pwdForm">',
		'<table class="updata-pwd-alert">',
		'<tr>',
		'<th>原始密码</th>',
		'<td>',
		'<div class="input"><span class="formText"><input name="txtOldPassword" type="password" placeholder="请输入原始密码" /></span><p data-for="txtOldPassword" class="error-msg"></p></div>',
		'</td>',
		'</tr><tr>',
		'<th>新密码</th>',
		'<td>',
		'<div class="input"><span class="formText"><input id="txtNewPassword" name="txtNewPassword" type="password" placeholder="请输入新密码" /></span><p data-for="txtNewPassword" class="error-msg"></p></div>',
		'</td>',
		'</tr><tr>',
		'<th>确认密码</th>',
		'<td>',
		'<div class="input"><span class="formText"><input name="txtRepeatPassword" type="password" placeholder="请再次输入新密码" /></span><p data-for="txtRepeatPassword" class="error-msg"></p></div>',
		'</td>',
		'</tr><tr>',
		'<th>&nbsp;&nbsp;</th>',
		'<td><div class="button"><a href="javascript:" class="blue-butn">提交</a><a href="javascript:" class="gray-btn">取消</a></div></td>',
		'</tr></table>',
		'</form>'
	].join('');

	var modPwdDialog = new Dialog({
		idName: 'uppwd_dialog',
		title: '密码修改',
		content: modPwdHTML,
		close: '╳',
		width: 350
	});

	var pwdRules = {
		txtOldPassword: {
			required: true
		},
		txtNewPassword: {
			required:true,
			range:[6, 18]
		},
		txtRepeatPassword: {
			required:true,
			range:[6, 18],
			equalTo:'#txtNewPassword'
		}
	};
	var pwdErrMsgs = {
		txtOldPassword: '请填写原密码',
		txtNewPassword: {
			required: '请填写新密码',
			range: '密码6-18位字符'
		},
		txtRepeatPassword: {
			required: '请确认密码',
			range: '密码6-18位字符',
			equalTo: '两次密码不一致'
		}
	}
	var pwdForm = modPwdDialog.query('#pwdForm');
	var modPwdValidator = new validator({
		element: pwdForm,
		rules: pwdRules,
		errorMessages: pwdErrMsgs,
		keepKey: true,
		errorElement: 'p'
	});

	modPwdDialog.query('.blue-butn').on('click', function(){
        var account_id = "{/$account_id/}";
        var oldPwd = $('input[name=txtOldPassword]').val();
        var newPwd = $('input[name=txtNewPassword]').val();;
		modPwdValidator.submit(function(){
            $.ajax({
                url:"{/get_url rule='/account/editPwd/'/}",
                type:"post",
                dataType: "json",
                data: {account_id:account_id,oldPwd:oldPwd,newPwd:newPwd},
                success:function(json){
                    if(json!=null&&json!=undefined&&json!=''){
                        if(json.status){
                            $.anchorMsg("修改成功！");
                            window.location.reload();
                        }else{
                            $.anchorMsg(json.msg);
                        }
                        return;
                    }
                    $.anchorMsg("修改密码失败，请稍后再试");
                }
            });
		});
	});
	modPwdDialog.query('.gray-btn').on('click', function(){
		pwdForm[0].reset();
		modPwdDialog.hide();
	});
	$('#upload-pwd').on('click', function(){
		modPwdDialog.show();
	});

	//密码验证规则
	var regErrMessage;
	function inputRegValiPwd(element){
		var value = element.val(),
                    patten = new RegExp('^[0-9]+$'),
                    numReg = /^(\d)\1+$/;
                var pwd_reg_length = /^\w{6,18}$/;
                var pwd_reg_1      = /[0-9]+/;
                var pwd_reg_2      = /[a-zA-Z]+/;
                var pwd_reg_3      = /([\w])\1{3,}/;
                var pwd_reg_4      = /[^\w]/;
                if(!pwd_reg_length.test(value) || pwd_reg_4.test(value)){
                    regErrMessage = "密码为6-18位数字+字母组合<span class='tipArr'></span>";
                    return false;
                }
                if(!pwd_reg_1.test(value) || !pwd_reg_2.test(value)){
                    regErrMessage = "密码为数字+字母组合<span class='tipArr'></span>";
                    return false; //密码为数字、字母、下划线组合
                }
                if(pwd_reg_3.test(value)){
                    regErrMessage = "单个字符不能连续输入4次及以上<span class='tipArr'></span>";
                    return false;//密码不能重复4个或以上字符
                }
		return true;
	}

	modPwdValidator.addMethod('inputRegValiPwd', inputRegValiPwd, function(){
		return regErrMessage;
	});
	modPwdValidator.addRules(
		'txtNewPassword', {
			inputRegValiPwd: true
		}
	);


	var validRules = {
                {/if $operate_is_main ==1 && !$is_self/}
                user_id:{
                    required:true,
                    range: [3, 20],
                    match:/^[A-Za-z0-9_]*$/,
                    remote: {
                        url: "{/get_url rule='/account/checkUserId/'/}?account_id={/$account_id/}",
                        type: 'post',
                        dataType: 'json',
                        data: { txtUserID: function(){
                            return $("input[name=user_id]").val();//好像这个没拿到
                        }},
                        callback: function(json) {
                            return json && json.state;
                        }
                    }
                },
                {//if/}
        user_name:{
			required: true,
			inputValiUserName: true
		},
		phone: {
			mobile: true
		},
		zone_infor: {
			match: /^([0-9]{3}[0-9]?)?$/
		},
		phone_infor: {
			match: /^([0-9]{6,8})?$/
		},
		ext_infor: {
			match: /^[0-9]{0,5}$/
		}
	};

	var errMsgs = {
                {/if $operate_is_main ==1 && !$is_self/}
                user_id: {
                    required: '<span class="tipLayErr tipw120">请填写账户名<span class="tipArr"></span></span>',
                    range: '<span class="tipLayErr tipw180">账户名3-20位字符<span class="tipArr"></span></span>',
                    match: '<span class="tipLayErr tipw180">账户名为字母、数字、下划线组成<span class="tipArr"></span></span>',
                    remote: '<span class="tipLayErr tipw180">该账户名已被注册，请更换<span class="tipArr"></span></span>'
                },
                {//if/}
		user_name:{
			required: '<span class="tipLayErr tipw120">请填写真实姓名<span class="tipArr"></span></span>'
		},
		phone: {
			mobile: '<span class="tipLayErr tipw120">请填写正确的手机号码<span class="tipArr"></span></span>'
		},
		zone_infor: '<span class="tipLayErr tipw120">请输入正确的区号<span class="tipArr"></span></span>',
		phone_infor: '<span class="tipLayErr tipw120">请输入6-8位的数字<span class="tipArr"></span></span>',
		ext_infor: '<span class="tipLayErr tipw120">请输入正确的座机号<span class="tipArr"></span></span>'
	};

	var telGroup = {tel: 'zone_infor phone_infor ext_infor'};
	var formValidator = new validator({
		element: $('#account-form'),
		rules: validRules,
		errorMessages: errMsgs,
		groups: telGroup,
		keepKey: true,
		errorElement: 'span'
	});

	//姓名验证
	var userNameErrMessage;
	function inputValiUserName(element){
		var value = element.val();
		var language = 	/^[A-Za-z0-9\u4e00-\u9fa5]+$/i;

		if(!language.test(value)){
			userNameErrMessage = '<span class="tipLayErr tipw120">姓名为中文或字母<span class="tipArr"></span></span>';
			return false;
		}

		language = /^[A-Za-z0-9]+$/i;
		if(language.test(value)){
			if(value.length < 2 || value.length > 20){
				userNameErrMessage = '<span class="tipLayErr tipw180">2-20位英文（1-10个汉字）<span class="tipArr"></span></span>';
				return false;
			}
		}

		language = /[\u4e00-\u9fa5]+/;
		if(language.test(value)){
			if(value.length < 1 || value.length > 10){
				userNameErrMessage = '<span class="tipLayErr tipw180">2-20位英文（1-10个汉字）<span class="tipArr"></span></span>';
				return false;
			}
		}

		return true;
	}

	formValidator.addMethod('inputValiUserName', inputValiUserName, function(){
		return userNameErrMessage;
	});

	$('#submitBtn').on('click', function(e){

		formValidator.submit(function(){
            $.ajax({
                url:"{/get_url rule='/account/doEditAccount/'/}",
                type:"post",
                dataType: "json",
                data: $('#account-form').serialize(),
                success:function(json){
                    if(json!=null&&json!=undefined&&json!=''){
                        if(json.status){
                            $.anchorMsg("修改成功！");
                            window.location.href = "{/get_url rule='/account/accountManage/'/}";
                        }else{
                            $.anchorMsg(json.msg);
                        }
                        return;
                    }
                    $.anchorMsg("修改用户失败，请稍后再试");
                }
            });
		});
	});

    $("#unbindWeixin").on("click",function(){
        var openid = $(this).attr('data-value');
        var _this = this;
        ConfirmBox.confirm('确定解除绑定吗？', '操作提示', function() {
            $.getJSON('{/get_url rule="/account/unbindweixin/"/}', {openid:openid}, function(result) {
                $(".cancelbtn").click();
                if(result.status) {
                    $(_this).parents('.formMod').remove();
                }
                $.anchorMsg(result.msg);
            });
        }, {
            width : 300,
            close : 'x'
        });
    });
});

</script>
</body>
</html>
