<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>offer编辑</title>
		<meta content="never" name="referrer">
		<script type="text/javascript" src="//assets.huibo.com/js/cp/My97DatePicker/WdatePicker.js?v=20190425"></script>
		<script type="text/javascript" language="javascript" src="{/version file='jquery-1.8.3.min.js'/}"></script>
		<script type="text/javascript" language="javascript" src="{/version file='dialog.js'/}"></script>
		<link rel="stylesheet" type="text/css" href="{/version file='base.css'/}" />
		<link rel="stylesheet" type="text/css" href="{/version file='editoffer.css'/}">
		<link rel="stylesheet" type="text/css" href="{/version file='md_offer.css'/}">
		<link rel="stylesheet" type="text/css" href="{/version file='m_font_style.css'/}">
		<link rel="stylesheet" type="text/css" href="http://www.huibo.com/css/v2/default/v2-widge.css?v=20190425" />
		<style>
			textarea,input{font-family: 'Microsoft YaHei' !important;}
			.xiaoxx {color: #de0000;font-style: normal;margin: 0 0 0 5px;width: 12px;position: absolute;top: 66px;left: 155px;}
		</style>
	</head>
	<body>
		<div class="header">
			<div class="headerContent">
				offer编辑
				<!-- <a href="javascript:history.go(-1)">返回</a> -->
			</div>
		</div>
		<div class="bodyTop">
			<span>更多模板：</span>
				{/if $template_list/}
					{/if !$has_ty_template/}
						<em {/if $is_ty_cut/}class="cut"{//if/}>通用模板</em>
					{//if/}
					{/foreach $template_list as $key => $val/}
						<em data-job_id="{/$val['job_id']/}" {/if $default_template['template_id'] == $val['template_id'] || ($val['template_type'] == 1 && $is_ty_cut1)/}class="cut"{//if/}>{/$val['template_name']/}{/if $val['template_type'] == 2/}<div class="tempDele" data-temp_id="{/$val['template_id']/}">×</div>{//if/}</em>
					{//foreach/}
				{/else/}
				<em class="cut">通用模板</em>
				{//if/}
		</div>
		<div class="body">
			<div class="bodyLeft">
				<div class="typeBox">
					<div class="typeItem {/if $default_template['tempalte_style'] == 2/}cut{//if/}" data-type="2">
						<img src="{/$siteurl.style/}/img/xiaoyuan/model/offerstyle2.jpg" alt="">
					</div>
					<div class="typeItem {/if $default_template['tempalte_style'] == 1/}cut{//if/}" data-type="1">
						<img src="{/$siteurl.style/}/img/xiaoyuan/model/offerstyle1.jpg" alt="">
					</div>
					
				</div>
				<div class="template_center {/if $default_template['tempalte_style'] == 2/}template_center02{//if/}">
					<div class="tm_content_bg {/if $default_template['tempalte_style'] == 2/}tm_content_bg02{//if/}">
					<div class="tm_img_bg {/if $default_template['tempalte_style'] == 2/}tm_img_bg02{//if/}">
						<img src="{/$logo/}" >
						<span>{/$company_info['company_name']/}</span>
					</div>
					<div class="tm_content {/if $default_template['tempalte_style'] == 2/}tm_content02{//if/}">
						<div id="job_intro" {/if $default_template['tpl_wellcome_show'] == 0/}style="display: none;"{//if/}>
							<h1 class="tm_user_name"><sapn class="job_user">{/$person_info['user_name']/}{/if $person_info['sex'] == 1/}先生{/else/}女士{//if/}</sapn>：</h1>
							<div class="tm_intro">
								<div class="job_intro">
									<p>{/$default_template['tpl_wellcome_txt']/}</p>
								</div>
							</div>
							<span class="icon-icon-04 userIcon"></span>
						</div>	
						<div class="tm_details">
							<span id="job_name" {/if $default_template['template_job_station_show'] == 0/}style="display: none;"{//if/}>入职职位：<em class="job_name">{/$default_template['template_job_station']/}</em>  </span>
							<span id="job_money" {/if $default_template['template_job_salary_show'] == 0/}style="display: none;"{//if/}>综合薪资：<em class="job_money">{/$default_template['template_job_salary']/}</em></span>
							<span id="job_test" {/if $default_template['template_job_probation_time_show'] == 0/}style="display: none;"{//if/}>试用期：<em class="job_test">{/$default_template['template_job_probation_time']/}</em></span>
							<span id="job_time" {/if $default_template['template_job_join_time_show'] == 0/}style="display: none;"{//if/}>入职时间：<em class="job_time">{/if $default_template['template_job_join_time'] && $default_template['template_job_join_time'] != '0000-00-00 00:00:00'/}{/date("Y年m月d日 H点",strtotime($default_template['template_job_join_time']))/}{//if/} </em></span>
							<span id="job_weal" {/if $default_template['template_job_reward_show'] == 0/}style="display: none;"{//if/}>福利待遇：<em class="job_weal">{/$default_template['template_job_reward']/}</em></span>
							<!-- <span id="">
								入职时间：<em style="color: #f51919;">待填写</em>
							</span> -->
							<span id="entry_place" {/if $default_template['template_link_probation_addres_show'] == 0/}style="display: none;"{//if/}>入职地点：<em class="entry_place">{/$default_template['template_link_probation_addres']/}</em></span>
							<span id="job_place" {/if $default_template['template_link_work_addres_show'] == 0/}style="display: none;"{//if/}>工作地点：<em class="job_place">{/$default_template['template_link_work_addres']/}</em></span>
							
							<span id="contact_people" {/if $default_template['template_link_man_show'] == 0&&$default_template['template_link_way_show'] == 0/}style="display: none;"{//if/}>联系人：
								<em class="job_people" id="job_people"  {/if $default_template['template_link_man_show'] == 0/}style="display:none"{//if/}>{/$default_template['template_link_man']/}</em>
								<em class="job_tele" id="job_tele"  {/if $default_template['template_link_way_show'] == 0/}style="display:none"{//if/}>{/$default_template['template_link_way']/}</em>
							</span>
							<span class="icon-icon-04 jobicon"></span>
						</div>
						<div class="tm_entry_matter" {/if $default_template['template_matter_list_show'] == 0/}style="display: none;"{//if/} id="job_matter">
							<h2>入职事项：</h2>
							<div class="job_matter">
								{/$default_template['template_matter_list_txt']/}
							</div>
							<span class="icon-icon-04 sxIcon"></span>
						</div>
						<div class="tm_entry_matter" id="job_thing" {/if $default_template['template_matter_means_show'] == 0/}style="display: none;"{//if/}>
							<h2>携带材料：</h2>
							<div class="job_thing">
								{/$default_template['template_matter_means_txt']/}
							</div>
							<span class="icon-icon-04 clIcon"></span>
						</div>
						
						<div class="tm_weal job_sup" id="job_sup" {/if $default_template['template_footnote_show'] == 0/}style="display: none;"{//if/}>
							<h2 style="font-size: 16px;color: #514091;font-weight: bold;padding-bottom: 15px;">补充说明：</h2>
							{/$default_template['template_footnote_txt']/}
							<span class="icon-icon-04 smIcon"></span>
						</div>
						<div class="tm_company" id="company_all" {/if $default_template['template_company_show'] == 0/}style="display: none;"{//if/}>
							<img src="{/$logo/}" >
							<p>
								<b>{/$company_info['company_name']/}</b>
								<span>地址：<em class="company_place">{/$company_info['address']/}</em></span>
								<span>电话：<em class="company_tele">{/$company_info['link_mobile']/}</em></span>
							</p>
							<span class="icon-icon-04 comIcon"></span>
						</div>
						
					</div>
					</div>
					<div class="tm_bgd_img {/if $default_template['tempalte_style'] == 2/}tm_bgd_img02{//if/}"></div>
				</div>
			</div>
			<div class="bodyRight">
				<!-- <div class="rightBtnBox">
					<div class="rightEditBtn">编辑内容</div>
					<div class="rightSaveBtn">保存为模板</div>
				</div> -->
				<form class="editBox" id="form1">
					<input type="hidden" id="hddModName" name="modelName" value="tongyong">
					<input type="hidden" id="hddModName1" name="modelName1" value="{/if $default_template['template_type'] == 1/}tongyong{/else/}{/$default_template['job_id']/}{//if/}">
					<input type="hidden" id="job_id" name="job_id" value="{/$job_id/}">
					<input type="hidden" id="invite_id" name="invite_id" value="{/$invite_id/}">
					<input type="hidden" id="send_type" name="send_type" value="1">
					<input type="hidden" id="tempalte_style" name="tempalte_style" value="{/$default_template['tempalte_style']/}">
					<div class="editHead">
						<div class="editTab w4 cut">欢迎语</div>
						<div class="editTab">职位相关</div>
						<div class="editTab">地点及联系人</div>
						<div class="editTab">事项材料</div>
						<div class="editTab">补充说明</div>
						<div class="editTab w6">企业名片</div>
						<div class="editCloseBtn">×</div>
					</div>
					<div class="editBody" id="editBody">
						<!-- 欢迎语 -->
						<div class="editView welcomeBox" id="chooseContent0">
							<div class="editRow">
								<span>求职者</span>
								<input type="text" placeholder="请输入" data-for="job_user" data-nochange="true" name="template_job_user_ipt" value="{/$person_info['user_name']/}{/if $person_info['sex'] == 1/}先生{/else/}女士{//if/}" data-maxl="10">
								<input type="hidden" name="template_job_user" value="{/$person_info['user_name']/}{/if $person_info['sex'] == 1/}先生{/else/}女士{//if/}">
								
							</div>
							<div class="editRow">
								<span>欢迎语内容</span>
								<textarea data-for="job_intro" data-format="br2p" data-count="true" name="tpl_wellcome_ipt" id="wel" data-maxl="200">{/$default_template['tpl_wellcome']/}</textarea>
								<textarea class="hiddenText" name="tpl_wellcome">{/$default_template['tpl_wellcome']/}</textarea>
								<div class="textareaNum"><span>{/mb_strlen($default_template['tpl_wellcome'])/}</span>字</div>
							</div>
							<div class="huany">
							<label class="editShow" data-show="job_intro"><input type="checkbox" value="0" class="huanyingcheckbox" name="tpl_wellcome_show" {/if $default_template['tpl_wellcome_show'] == 0/}checked="checked"{//if/}>不展示欢迎语</label>
							</div>
							<div class="editOk" data-save="true" data-list="wel">确定</div>
						</div>
						
						<!-- 职位相关 -->
						<!-- cut -->
						<div class="editView" id="chooseContent1">
							<div class="editRow">
								<div>入职职位<em>*</em></div>
								<input type="text" placeholder="请输入" data-for="job_name" name="template_job_station_ipt" value="{/$default_template['template_job_station']/}" data-maxl="50">
								<input type="hidden" name="template_job_station" value="{/$default_template['template_job_station']/}">
								<label class="editShow" data-show="job_name"><input type="checkbox" value="0" class="ruzhicheckbox" name="template_job_station_show" {/if $default_template['template_job_station_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editRow">
								<div>入职时间<em>*</em></div>
								<input type="text" placeholder="请输入" data-nochange="true" onclick="WdatePicker({dateFmt:'yyyy年M月d日 H点'})" name="template_job_join_time_ipt" data-for="job_time" value="{/if $default_template['template_job_join_time'] && $default_template['template_job_join_time'] != '0000-00-00 00:00:00'/}{/date('Y年m月d日 H点',strtotime($default_template['template_job_join_time']))/}{//if/}" data-maxl="50">
								<input type="hidden" name="template_job_join_time" value="{/if $default_template['template_job_join_time'] && $default_template['template_job_join_time'] != '0000-00-00 00:00:00'/}{/date('Y年m月d日 H点',strtotime($default_template['template_job_join_time']))/}{//if/}">
								<label class="editShow" data-show="job_time"><input type="checkbox" value="0" class="timecheckbox" name="template_job_join_time_show" {/if $default_template['template_job_join_time_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editRow">
								<span>试用期</span>
								<input type="text" placeholder="请输入" data-for="job_test" name="template_job_probation_time_ipt" value="{/$default_template['template_job_probation_time']/}" data-maxl="50">
								<input type="hidden" name="template_job_probation_time" value="{/$default_template['template_job_probation_time']/}">
								<label class="editShow" data-show="job_test"><input type="checkbox" value="0" class="shiyongcheckbox" name="template_job_probation_time_show" {/if $default_template['template_job_probation_time_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editRow">
								<span>综合薪资</span>
								<textarea placeholder="不超过50字" data-nochange="true" data-format="br2br" data-for="job_money" data-maxl="50" name="template_job_salary_ipt">{/$default_template['template_job_salary']/}</textarea>
								<textarea class="hiddenText" name="template_job_salary">{/$default_template['template_job_salary']/}</textarea>
								<label class="editShow" data-show="job_money"><input type="checkbox" value="0" class="xinzicheckbox" name="template_job_salary_show" {/if $default_template['template_job_salary_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editRow">
								<span>福利待遇</span>
								<textarea placeholder="不超过50字" data-format="br2br" data-for="job_weal" data-maxl="50" name="template_job_reward_ipt">{/$default_template['template_job_reward']/}</textarea>
								<textarea class="hiddenText" name="template_job_reward">{/$default_template['template_job_reward']/}</textarea>
								<label class="editShow" data-show="job_weal"><input type="checkbox" value="0" class="fulicheckbox" name="template_job_reward_show" {/if $default_template['template_job_reward_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editOk">确定</div>
						</div>
						
						<!-- 地点及联系人 -->
						<div class="editView" id="chooseContent2">
							<div class="editRow">
								<span>入职地点</span>
								<textarea placeholder="不超过50字" data-for="entry_place" name="template_link_probation_addres_ipt" data-format="br2br" data-maxl="50">{/$default_template['template_link_probation_addres']/}</textarea>
								<textarea class="hiddenText" name="template_link_probation_addres">{/$default_template['template_link_probation_addres']/}</textarea>
								<label class="editShow" data-show="entry_place"><input type="checkbox" value="0" class="didiancheckbox" name="template_link_probation_addres_show" {/if $default_template['template_link_probation_addres_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editRow">
								<span>上班地点</span>
								<textarea placeholder="不超过50字" data-for="job_place" name="template_link_work_addres_ipt" data-format="br2br" data-maxl="50">{/$default_template['template_link_work_addres']/}</textarea>
								<textarea class="hiddenText" name="template_link_work_addres">{/$default_template['template_link_work_addres']/}</textarea>
								<label class="editShow" data-show="job_place"><input type="checkbox" class="shangbancheckbox" name="template_link_work_addres_show" value="0" {/if $default_template['template_link_work_addres_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editRow">
								<span>联系人</span>
								<input type="text" placeholder="请输入" data-for="job_people" name="template_link_man_ipt" value="{/$default_template['template_link_man']/}" data-maxl="50">
								<input type="hidden" name="template_link_man" value="{/$default_template['template_link_man']/}">
								<label class="editShow" data-show="job_people"><input type="checkbox" class="lianxirencheckbox" name="template_link_man_show" value="0" {/if $default_template['template_link_man_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editRow">
								<span>联系电话</span>
								<input type="text" placeholder="请输入" data-for="job_tele" name="template_link_way_ipt" value="{/$default_template['template_link_way']/}" data-maxl="50">
								<input type="hidden" name="template_link_way" value="{/$default_template['template_link_way']/}">
								<label class="editShow" data-show="job_tele"><input type="checkbox" value="0" class="lianxidianhuacheckbox" name="template_link_way_show" {/if $default_template['template_link_way_show'] == 0/}checked="checked"{//if/}>不展示</label>
							</div>
							<div class="editOk">确定</div>
						</div>
						
						
						<!-- 事项及材料 -->
						<div class="editView" id="chooseContent3">
							<div>
								<h6>入职事项</h6>
								<textarea class="hiddenText" name="template_matter_list">{/$default_template['template_matter_list']/}</textarea>
								<textarea data-for="job_matter" data-format="br2p" name="template_matter_list_ipt" id="matter" data-maxl="500">{/$default_template['template_matter_list']/}</textarea>
								<!-- <div class="textareaNum"><span>203</span>字</div> -->
								<label class="editShow mp10" data-show="job_matter"><input type="checkbox" value="0" class="ruzhishixiangcheckbox" name="template_matter_list_show" {/if $default_template['template_matter_list_show'] == 0/}checked="checked"{//if/}>不展示入职事项</label>
								<div class="editOk" data-save="true" data-list="matter">确定</div>
							</div>
							<div class="editView2" id="xdcl">
								<h6>携带材料</h6>
								<textarea class="hiddenText" name="template_matter_means">{/$default_template['template_matter_means']/}</textarea>
								<textarea data-for="job_thing" data-format="br2p" name="template_matter_means_ipt" id="thing" data-maxl="500">{/$default_template['template_matter_means']/}</textarea>
								<!-- <div class="textareaNum"><span>203</span>字</div> -->
								<label class="editShow mp10" data-show="job_thing"><input type="checkbox" value="0" class="xiedaicailiaocheckbox" name="template_matter_means_show" {/if $default_template['template_matter_means_show'] == 0/}checked="checked"{//if/}>不展示携带材料</label>
								<div class="editOk" data-save="true" data-list="thing">确定</div>
							</div>
						</div>
						
						
						<!-- 补充说明 -->
						<div class="editView" id="chooseContent4">
							<textarea class="hiddenText" name="template_footnote">{/$default_template['template_footnote']/}</textarea>
							<textarea data-for="job_sup" data-format="br2br" data-count="true" name="template_footnote_ipt" id="sup" data-maxl="500">{/$default_template['template_footnote']/}</textarea>
							<div class="textareaNum"><span>{/mb_strlen($default_template['template_footnote'])/}</span>字</div>
							<label class="editShow" data-show="job_sup"><input type="checkbox" value="0" class="buchongcheckbox" name="template_footnote_show" {/if $default_template['template_footnote_show'] == 0/}checked="checked"{//if/}>不展示补充说明</label>
							<div class="editOk" data-save="true" data-list="sup">确定</div>
						</div>
						
						<!-- 企业名片 -->
						<div class="editView companyView" id="chooseContent5">
							<div class="editRow editRow2">
								<span>公　　司</span>
								<input type="text" placeholder="请输入" name="company_name" readonly="readonly" value="{/$company_info['company_name']/}">
							</div>
							<div class="editRow editRow2">
								<span>地　　址</span>
								<input type="text" placeholder="请输入" name="address_ipt" data-for="company_place" id="company_place_ipt" value="{/$company_info['address']/}" data-maxl="50">
								<input type="hidden" name="address" data-for="company_place" value="{/$company_info['address']/}">
							</div>
							<div class="editRow editRow2">
								<span>电　　话</span>
								<input type="text" placeholder="请输入" name="link_mobile_ipt" data-for="company_tele" id="company_tele_ipt" value="{/$company_info['link_mobile']/}" data-maxl="50">
								<input type="hidden" name="link_mobile" value="{/$company_info['link_mobile']/}">
							</div>
							<label class="editShow"  data-show="company_all"><input type="checkbox" value="0" class="qiyemingpiancheckbox" name="template_company_show" {/if $default_template['template_company_show'] == 0/}checked="checked"{//if/}>不展示企业名片</label>
							<div class="editOk">确定</div>
						</div>

						<div class="" style="height: 750px"></div>
					</div>

				</form>
			</div>

		</div>
		<div class="box_bototm">
		<div class="su_bx">
			<span>手机号<em>*</em></span>
			<input type="text" placeholder="请输入" data-for="job_tele" name="template_link_way_ipt" value="" data-maxl="50">
			<input type="hidden" name="template_link_way" value="">
			<!-- <label class="editShow" data-show="job_tele"><input type="checkbox" value="0" class="lianxidianhuacheckbox" name="template_link_way_show" {/if $default_template['template_link_way_show'] == 0/}checked="checked"{//if/}>不展示</label> -->
		</div>
		<div class="su_bx">
			<span>邮箱</span>
			<input type="text" placeholder="请输入" data-for="job_tele" name="template_link_way_ipt" value="" data-maxl="50">
			<input type="hidden" name="template_link_way" value="">
			<!-- <label class="editShow" data-show="job_tele"><input type="checkbox" value="0" class="lianxidianhuacheckbox" name="template_link_way_show" {/if $default_template['template_link_way_show'] == 0/}checked="checked"{//if/}>不展示</label> -->
		</div>
		</div>
		<div class="bodyBottom">
			<div class="bottomBtn">发送</div>
		</div>
		<div class="hddSaveTemp">
			<select id="saveName" class="saveName" name="template_list">
				<option value ="tongyong">通用模板</option>
				{/foreach $job_list as $key => $val/}
					<option value ="{/$val['job_id']/}">{/base_lib_BaseUtils::cutstr($val['station'], 15,'utf-8','','...')/}</option>
				{//foreach/}
			</select>
		</div>
		<div class="hddSendTemp">
			<div class="sendContent">
				<h4 class="tongzhi">已短信和邮箱通知求职者，您还可以：</h4>
				<!-- <table>
					<tr>
						<td class="tar">发送到邮箱</td>
						<td><input type="text" id="send_email" value="{/$person_info['email']/}"></td>
						<td><div class="sendBtn" data-way="1">发送</div></td>
					</tr>
					
					
				</table> -->
				<input type="hidden" id="send_offer_id">
				<input type="hidden" id="send_person_id">
				<div class="qrBox">
					<img src="" alt="" class="qrCode"><br>
					<span>微信扫码一键发送offer</span>
				</div>
			</div>
		</div>
		<div class="hddSendPhone">
			<div class="sendContent">
				<table>
					<tr>
						<td class="tar">短信发送<i class="xiaoxx">*</i></td>
						<td><input type="text" id="send_phone" value="{/$person_info['mobile_phone']/}"></td>
					</tr>
					<tr>
						<td class="tar">邮箱发送</td>
						<td><input type="text" id="send_email" value="{/$person_info['email']/}"></td>
					</tr>
				</table>
				<div>
					<div class="blueBtn_temp" data-way="2">发送</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			var sendPhone="{/$person_info['mobile_phone']/}";
			var hddSaveTemp=$('.hddSaveTemp').remove();
			var hddSendPhone=$('.hddSendPhone').remove();
			var typeNow=$('#tempalte_style').val();//当前选择的模板
			var isChange=false;//是否修改了offer模板
			var isSaveTemplate = false  //是否保存为模板
			var formats={
				br2p:function(str){
					return '<p>'+str.replace(/\n/g,'</p><p>')+'</p>'
				},
				br2br:function(str){
					return str.replace(/\n/g,'<br>')
				},
			}
			if(localStorage){
				//获取数据
				var localLists={
					wel:localStorage.getItem('wel')?JSON.parse(localStorage.getItem('wel')):[],
					sup:localStorage.getItem('sup')?JSON.parse(localStorage.getItem('sup')):[],
					matter:localStorage.getItem('matter')?JSON.parse(localStorage.getItem('matter')):[],
					thing:localStorage.getItem('thing')?JSON.parse(localStorage.getItem('thing')):[],
				}
				//初始化历史记录
				function initHis(list){
					if(localLists[list].length===0){
						$('.editHistory[data-list='+list+']').remove()
						return false;
					}
					if($('.editHistory[data-list='+list+']').length===0){
						$('.editOk[data-list='+list+']').after('<div class="editHistory" data-list='+list+'><h6>历史使用</h6><ul></ul></div>')
			
					}
					var text='';
					$.each(localLists[list],function(i,e){
						text+='<li class="historyItem" data-index='+i+' data-for='+e.for+'><div class="historyDele">×</div><div class="historyText" data-text='+e.text+'>'+(e.text.length<25?e.text:(e.text.substring(0,25)+'...'))+'</div></li>'
					})
					$('.editHistory[data-list='+list+'] ul').html(text)
				}
				//存为localStorage
				function saveLocal(list){
					localStorage.setItem(list,JSON.stringify(localLists[list]))
				}
				//调用初始化
				$('.editOk[data-save]').each(function(i,e){
					initHis($(e).attr('data-list'))
				})
				// 点击历史记录
				$('.editView').on('click','.historyText',function(){
					var parent=$(this).parent();
					// var index=parent.attr('data-index');
					var list=parent.attr('data-for');
					$('#'+list).val($(this).attr("data-text"))
					// var li=localLists[list].splice(index,1)
					// saveLocal(list)
				})
				//删除历史记录
				$('.editView').on('click','.historyDele',function(){
					var parent=$(this).parent();
					var list=parent.attr('data-for');
					var index=parent.attr('data-index');
					localLists[list].splice(index,1)
					initHis(list)
				})
			}
			
			
			//点击编辑
			$('.rightEditBtn').on('click',function(){
				$('.rightBtnBox').hide()
				$('.editBox').show()
				
			})
			
			//关闭编辑
			$('.editCloseBtn').on('click',function(){
				//$('.editOk').click()
				
				$('.rightBtnBox').show()
				$('.editBox').hide()
				
			})
			
			//选择编辑的模块
			// $('.editTab').on('click',function(){
			// 	$('.editTab,.editView').removeClass('cut')
			// 	$('.editView').eq($(this).addClass('cut').index()).addClass('cut')
			// })
			$('.userIcon').on('click',function(){
				document.getElementById('editBody').scrollTop = 0
			})
			$('.jobicon').on('click',function(){
				let Dheigth = document.getElementById('chooseContent1').offsetTop
				document.getElementById('editBody').scrollTop = Dheigth
			})
			$('.sxIcon').on('click',function(){
				let Dheigth = document.getElementById('chooseContent3').offsetTop
				document.getElementById('editBody').scrollTop = Dheigth
			})
			$('.clIcon').on('click',function(){
				let Dheigth = document.getElementById('xdcl').offsetTop
				document.getElementById('editBody').scrollTop = Dheigth
			})
			$('.smIcon').on('click',function(){
				let Dheigth = document.getElementById('chooseContent4').offsetTop
				document.getElementById('editBody').scrollTop = Dheigth
			})
			$('.comIcon').on('click',function(){
				let Dheigth = document.getElementById('chooseContent5').offsetTop
				document.getElementById('editBody').scrollTop = Dheigth
			})
			$('.editTab').on('click',function(){
				$(this).addClass('cut').siblings().removeClass('cut')
				// let topJu = document.getElementById('editBody').offsetTop
				// let bb = document.getElementById('ttt').offsetTop
				let addId =  'chooseContent' + $(this).index()
				
				let Dheigth = document.getElementById(addId).offsetTop
				document.getElementById('editBody').scrollTop = Dheigth
				// document.getElementsByClassName('editBody').scrollTop()
				 // $('#ttt').scrollTop('30')
				 console.log('获取的下标id',addId)
				 console.log('相对于父亲的高度',Dheigth)
				 // console.log('距离页面顶部距离',$('.editView').eq($(this).index()).offsetTop)
				// console.log('滚动的div距离顶部距离',topJu)
				// console.log('相对于父元素高度',bb)
			})
			
			//自定义滚动位置
			function upload() {
			    let btn = document.getElementById('main_btn'); 
			    let x = btn.offsetTop + 1200;
			    if (!!u.match(/AppleWebKit.*Mobile.*/)) {   //判断是否在移动端打开的
			      x = btn.offsetTop + 400;
			    }
			    let timer = setInterval(() => {
			      document.documentElement.scrollTop += 100
			      if (document.documentElement.scrollTop >= x) {
			        clearInterval(timer)
			      }
			    }, 20);
			    let timer_1 = setInterval(() => {
			      window.pageYOffset += 100
			      if (window.pageYOffset >= x) {
			        clearInterval(timer_1)
			      }
			    }, 20);
			    let timer_2 = setInterval(() => {
			      document.body.scrollTop += 100
			      if (document.body.scrollTop >= x) {
			        clearInterval(timer_2)
			      }
			    }, 20);
			  }
			
			//保存单个编辑的内容
			$('.editOk').on('click',function(){
				// 又不用验证了
				// 验证是否有输入内容
				// var parent=$(this).parents('.editView');
				// var flag=true;
				// if(parent.hasClass('companyView')){
				// 	//对企业名片单独处理
				// 	if(parent.find('.editShow').find(':checked').length===0 && ($('#company_place_ipt').val()==0||$('#company_tele_ipt').val()==0)){
				// 		flag=false;
				// 		//暂时用alert代替
				// 		$.message('请输入内容或不展示该模块')
				// 		return false
				// 	}
				// }else if(parent.hasClass('editView2')){
				// 	//对事项及材料单独处理
				// 	var myParent=$(this).parent();
				// 	if(myParent.find('.editShow').find(':checked').length===0&&myParent.find('textarea').val().length===0){
				// 		flag=false;
				// 		//暂时用alert代替
				// 		$.message('请输入内容或不展示该模块')
				// 		return false
				// 	}
				// }else{
				// 	//其余的editView都是一个checkbox对应一个输入框且一个页面只有一个确定按钮
				// 	parent.find('.editShow').each(function(i,e){
				// 		if($(e).find(':checked').length===0&&$(e).siblings('input,textarea').val().length===0){
				// 			flag=false;
				// 			//暂时用alert代替
				// 			$.message('请输入内容或不展示该模块')
				// 			return false
				// 		}
				// 	})
				// }
				// if(!flag)return false;
				
				//循环带入值
				$(this).parent().find('input[data-for],textarea[data-for]').each(function(i,e){
					//格式化字符串
					var text='';
					var format=$(this).attr('data-format')
					if(format!==undefined && formats[format]!==undefined){
						text=formats[format]($(e).val())
					}else{
						text=$(e).val()
					}
					//把值写入左边的预览中
					$('.'+$(e).attr('data-for')).html(text)
					$('[name='+$(e).prop('name').replace(/_ipt$/,'')+']').val($(e).val())
					
				})
				
				//保存历史记录
				if(localStorage){
					var name=$(this).attr('data-list');
					var text=$('#'+name).val();
					console.log(text)
					if(!text){return false}
					
					if($(this).attr('data-save')!==undefined){
						
						var thisList=localLists[name];
						var isRepeat=false;
						console.log(thisList)
						$.each(thisList,function(i,e){
							if(text==e.text){
								isRepeat=true;
								return false
							}
							
						})
						if(isRepeat){return false};
						thisList.unshift({
							for:name,
							text:text
						})
						if(thisList.length>3)thisList.pop()
						initHis(name)
						saveLocal(name)
					}
				}
			})
			
			
			//勾选不展示隐藏
			$('.editShow').on('click',function(e){
				if ($(e.target).is("input")){
					var type=$(this).attr('data-show')
					if($(this).find(':checked').length===0){
						$('#'+type).show()
					}else{
						$('#'+type).hide()
					}
					if(type==='job_people'||type==='job_tele'){
						console.log($('[data-show=job_people]').find(':checked').length)
						if($('[data-show=job_people]').find(':checked').length===1 && $('[data-show=job_tele]').find(':checked').length===1){
							$('#contact_people').hide()
						}else{
							$('#contact_people').show()
						}
					}
					isChange=true;
					isSaveTemplate=false;
				}
			})
			// 限制最大输入字数
			$('[data-maxl]').on('input propertychange',function(){
				var maxL=$(this).attr('data-maxl');
				if(this.value.length>maxL){
					this.value=this.value.substring(0,maxL)
				}
			})
			
			//字数统计
			$('[data-count]').on('input propertychange',function(){
				$(this).siblings('.textareaNum').find('span').html(this.value.length)
			})
			
			//改变ischange
			$('input[data-for],textarea[data-for]').on('input propertychange',function(){
				if(!$(this).attr('data-nochange')){
					isChange=true;
					isSaveTemplate=false;
				}
			})
			
			// 选择风格
			$('.typeItem').on('click',function(){
				var thisId = $(this).attr('data-type');
				if(thisId==typeNow)return false
				$(this).addClass('cut').siblings().removeClass('cut');
				var typeText=typeNow<10 ? ('0'+typeNow) : typeNow;
				var thisIdText=thisId<10 ? ('0'+thisId) : thisId;
				$('.template_center').removeClass('template_center'+typeText);
				$('.tm_content_bg').removeClass('tm_content_bg'+typeText);
				$('.tm_img_bg').removeClass('tm_img_bg'+typeText);
				$('.tm_content').removeClass('tm_content'+typeText);
				$('.tm_bgd_img').removeClass('tm_bgd_img'+typeText);
				if(thisId != '1'){
					$('.template_center').addClass('template_center'+thisIdText);
					$('.tm_content_bg').addClass('tm_content_bg'+thisIdText);
					$('.tm_img_bg').addClass('tm_img_bg'+thisIdText);
					$('.tm_content').addClass('tm_content'+thisIdText);
					$('.tm_bgd_img').addClass('tm_bgd_img'+thisIdText);
				}
				typeNow=thisId;
				$('#tempalte_style').val(typeNow)
			})
			
			
			// 选择模板
			$('.bodyTop em').on('click',function(){
				var invite_id = $("#invite_id").val();
				var job_id = $(this).attr("data-job_id");
				if(isChange){
					$.confirm('是否更换模板？',function(){
						//跳转页面
						location.href="{/get_url rule='/offertemplate/index/' data='is_change=1&invite_id="+invite_id+"&template_job_id="+job_id+"'/}"
					})
				}else{
					//跳转页面
					location.href="{/get_url rule='/offertemplate/index/' data='is_change=1&invite_id="+invite_id+"&template_job_id="+job_id+"'/}"
				}
			})
			
			//删除模板
			$('.tempDele').on('click',function(){
				var template_id = $(this).attr("data-temp_id");
				$.confirm('确定删除？',function(){
					$.ajax({
						type: 'post',
						url: "{/get_url rule='/offertemplate/delOfferTemplate'/}",
						data: {template_id:template_id},
						dataType: 'json',
						success: function (data) {
							if(!data.status){
								$.message(data.msg);
								return false;
							}

							$.message(data.msg,function(){
								window.location.reload();
							});
							
							return false;
						}
					})
				})
				return false;
			})
			
			$(document).on('input propertychange','#saveName',function(){
				$('#hddModName').val($(this).val())
			})
			// 提交保存
			function saveOfferTemplateMod(){
				var invite_id = $("#invite_id").val();
				var template_job_id = $("#hddModName").val();
				if(template_job_id == 'tongyong'){
					template_job_id = '';
				}
				$.ajax({
					type: 'post',
					url: "{/get_url rule='/offertemplate/saveOfferTemplate'/}",
					data: $("#form1").serialize(),
					dataType: 'json',
					success: function (data) {
						if(!data.status){
							$.message(data.msg);
							return false;
						}
						isSaveTemplate = true;
						$.message(data.msg,function(){
//							window.location.reload();
							location.href="{/get_url rule='/offertemplate/index/' data='is_change=1&invite_id="+invite_id+"&template_job_id="+template_job_id+"'/}"
						});
						
						return false;
					}
				})
			}

			// 发送offer
			function sendOffer(){
				$.ajax({
					type: 'post',
					url: "{/get_url rule='/offertemplate/SendOffer'/}",
					data: $("#form1").serialize()+"&send_phone="+$('#send_phone').val() + "&send_email=" + $('#send_email').val(),
					dataType: 'json',
					success: function (data) {
						if(!data.status){
							$.message(data.msg);
							return false;
						}
						isSaveTemplate = true;
						$("#send_offer_id").val(data.send_offer_id);
						$("#send_person_id").val(data.person_id);
						var dialog=$.message($('.hddSendTemp').html(),{
							contentType:'html',
							width:450,
							showOk:false
						})
						dialog.onclose(function(){
							location.href=location.href
						})
						dialog.find('.qrCode').prop('src',data.img_url);
						
						return false;
					}
				})
			}
			
			//判断是否邮箱发送
			function isEmile() {
				if($('#send_email').val().length == 0) {
					$('.tongzhi').html('已短信通知求职者，您还可以：')
				}else {
					$('.tongzhi').html('已短信和邮箱通知求职者，您还可以：')
				}
				return
			}
			
			
			//保存模板
			$(".rightSaveBtn").click(function(){
				$("#hddModName").val("tongyong");
				$.confirm(hddSaveTemp.html(),function(){
					checkSaveTemplate(1);
				});
				
			});

			function checkSaveTemplate(type){

				var template_type = $('#hddModName').val();
				if(template_type == '' || template_type == undefined){
					$.message('请选择需要保存的模板');
					return false;
				}
				$.ajax({
					type: 'post',
					url: "{/get_url rule='/offertemplate/CheckSaveTemplate'/}",
					data: {template_type:template_type},
					dataType: 'json',
					success: function (data) {
						if(!data.status){
							if(data.code == 310){
								$.confirm(data.msg,function(){
									if(type == 1){
										saveOfferTemplateMod();
									}else{
										sendOffer();
									}

								});
								return false;
							}else{
								$.message(data.msg);
								return false;
							}
						}
						if(type == 1){
							saveOfferTemplateMod();
						}else{
							sendOffer();
						}
					}
				})
			}

			//点击发送
			$(".bodyBottom").click(function(){
				
				//异步验证是否有数据为空
				$.ajax({
					type: 'post',
					url: "{/get_url rule='/offertemplate/CheckOfferData'/}",
					data: $("#form1").serialize(),
					dataType: 'json',
					success: function (data) {
						if(data.status){
							//已对模板进行修改，但未保存为新模板，二次弹框提示“确定发送offer吗？是否需要保存为模板？
							if(isChange && !isSaveTemplate){
								var saveConfirm=$.confirm('是否需要保存为模板？','提示',
									function(){
										var dialog=$.message(hddSendPhone.html(),{
											contentType:'html',
											width:450,
											showOk:false
										})
										dialog.find('.blueBtn_temp').on('click',function(){
											isEmile()
											sendOffer()
											$(this).closeDialog()
											// $(this).find('._dialogClose').click()
										})
									}
								)
								saveConfirm.find('._dialogOk').html('直接发送')
								saveConfirm.find('._dialogCancel').html('保存模板并发送').on('click',function(){
									$("#send_type").val(2);
									$("#hddModName").val("tongyong");
									$.confirm(hddSaveTemp.html(),function(){
										var template_type = $('#hddModName').val();
										if(template_type == '' || template_type == undefined){
											$.message('请选择需要保存的模板');
											return false;
										}
										$.ajax({
											type: 'post',
											url: "{/get_url rule='/offertemplate/CheckSaveTemplate'/}",
											data: {template_type:template_type},
											dataType: 'json',
											success: function (data) {
												if(!data.status){
													
													if(data.code == 310){
														$.confirm(data.msg,function(){
															var dialog=$.message(hddSendPhone.html(),{
																contentType:'html',
																width:450,
																showOk:false
															})
															dialog.find('.blueBtn_temp').on('click',function(){
																isEmile()
																sendOffer()
																$(this).closeDialog()
																// $(this).find('._dialogClose').click()
															})
														});
														return false;
													}else{
														$.message(data.msg);
														return false;
													}
												}
													var dialog=$.message(hddSendPhone.html(),{
														contentType:'html',
														width:450,
														showOk:false
													})
													dialog.find('.blueBtn_temp').on('click',function(){
														isEmile()
														sendOffer()
														$(this).closeDialog()
														// $(this).find('._dialogClose').click()
													})
											}
										})
										// checkSaveTemplate(2);
										
									})
								})
							}else{
								//本次发送时，未对模板进行修改，或对模板进行修改，但已保存为新模板，二次弹框提示“确定发送offer吗
								// $.confirm(hddSavePhone.html(),function(){
								// 	$("#send_type").val(1);
								// 	sendOffer();
								// });
								// $.confirm(hddSendPhone.html()).find('.sendPhoneBtn').on('click',function(){
								// 	console.log($('#send_phone').val())
								// })
								var dialog=$.message(hddSendPhone.html(),{
									contentType:'html',
									width:450,
									showOk:false
								})
								dialog.find('.blueBtn_temp').on('click',function(){
									isEmile()
									sendOffer()
									$(this).closeDialog()
									// $(this).find('._dialogClose').click()
								})
							}
						}else{
							if(data.code == 501){
								$.message(data.msg);
								window.location.reload();
							}
							$.message(data.msg)
						}
					}
				})
			});
			
			
			$(document).on('click','.sendBtn',function(){
				var sendWay=$(this).attr('data-way');
				var linkNum=$(this).parents('tr').eq(0).find('input').val();
				var send_offer_id = $("#send_offer_id").val();
				var send_person_id = $("#send_person_id").val();
				$.ajax({
					type: 'post',
					url: "{/get_url rule='/offertemplate/OtherSendOffer'/}",
					data: {send_type:sendWay,linkNum:linkNum,send_offer_id:send_offer_id,person_id:send_person_id},
					dataType: 'json',
					success: function (data) {
						if(!data.status){
							$.message(data.msg);
							return false;
						}
						$.message(data.msg);
					}
				})
			})
			
			
			$('[name="tpl_wellcome_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.huanyingcheckbox').prop('checked',false)
				$('#job_intro').show()
			});   //欢迎语
			
			$('[name="template_job_station_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.ruzhicheckbox').prop('checked',false)
				$('#job_name').show()
			});   //入职职位
			
			$('[name="template_job_join_time_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.timecheckbox').prop('checked',false)
				$('#job_time').show()
			});   //入职时间
			
			$('[name="template_job_probation_time_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.shiyongcheckbox').prop('checked',false)
				$('#job_test').show()
			});   //试用期
			
			$('[name="template_job_salary_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.xinzicheckbox').prop('checked',false)
				$('#job_money').show()
			});   //综合薪资
			
			$('[name="template_job_reward_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.fulicheckbox').prop('checked',false)
				$('#job_weal').show()
			});   //福利待遇
			
			$('[name="template_link_probation_addres_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.didiancheckbox').prop('checked',false)
				$('#entry_place').show()
			});   //入职地点
			
			$('[name="template_link_work_addres_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.shangbancheckbox').prop('checked',false)
				$('#job_place').show()
			});   //上班地点
			
			$('[name="template_link_man_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.lianxirencheckbox').prop('checked',false)
				$('#job_people').show()
			});   //联系人
			
			$('[name="template_link_way_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.lianxidianhuacheckbox').prop('checked',false)
				$('#job_tele').show()
			});   //联系电话
			
			$('[name="template_matter_list_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.ruzhishixiangcheckbox').prop('checked',false)
				$('#job_matter').show()
			});   //入职事项
			
			$('[name="template_matter_means_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.xiedaicailiaocheckbox').prop('checked',false)
				$('#job_thing').show()
			});   //携带材料
			
			$('[name="template_footnote_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.buchongcheckbox').prop('checked',false)
				$('#job_sup').show()
			});   //补充说明
			
			$('[name="address_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.qiyemingpiancheckbox').prop('checked',false)
				$('#company_all').show()
			});   //企业名片
			
			$('[name="link_mobile_ipt"]').bind('input propertychange', function(){
				if($(this).val().length == 0){
					return
				}
				$('.qiyemingpiancheckbox').prop('checked',false)
				$('#company_all').show()
			});   //企业名片
			
			
			// var backurl=document.referrer;
			// var cookieurl=getCookie('backurl');
			// if(backurl){
			// 	if(cookieurl){
			// 		
			// 	}else{
			// 		setCookie('backurl',backurl)
			// 	}
			// }else{
			// 	if(cookieurl){
			// 		backurl=getCookie('backurl');
			// 	}else{
			// 		backurl=""
			// 	}
			// }
			// $('.header a').on('click',function(){
			// 	if(backurl){
			// 		location.href=backurl;
			// 		delCookie('backurl');
			// 		return false
			// 	}
			// })
			// 
			// function setCookie(name,value)
			// {
			// var Days = 30;
			// var exp = new Date();
			// exp.setTime(exp.getTime() + Days*24*60*60*1000);
			// document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
			// }
			// function getCookie(name)
			// {
			// var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
			// if(arr=document.cookie.match(reg))
			// return unescape(arr[2]);
			// else
			// return null;
			// }
			// function delCookie(name)
			// {
			// var exp = new Date();
			// exp.setTime(exp.getTime() - 1);
			// var cval=getCookie(name);
			// if(cval!=null)
			// document.cookie= name + "="+cval+";expires="+exp.toGMTString();
			// }
		</script>
	</body>
</html>
